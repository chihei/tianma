/**
 * Default config for Alibaba-B2B-ICBU-F2E develop environment.
 * Auto-generated by Tianma v0.7.0
 */

var tianma = require('tianma'),
	pipe = tianma.pipe;

tianma
	.createHost({ port: config.port || 80, portssl: config.portssl || 443 })
		.mount('*.aliunicorn.com', [
			pipe('tianma-unicorn@1.0.15', { source: 'loop://localhost/' }),
			(function (proxy) {
				return function (context, next) {
					if (context.request.protocol === 'https:') {
						proxy(context, next);
					} else {
						next();
					}
				};
			}(pipe.proxy({
				'loop://localhost/$1': /\/\/.*?\/([sw]img\/.*)/,
				'http://img.alibaba.com@42.156.172.43/$1': /\/\/.*?\/(img\/(?:portrait|company)\/.*)/
			})))
		])
		.mount('/', [
			pipe.static({ root: config.root || './htdocs' }),
			pipe.proxy({
				'http://style.alibaba.com@42.156.172.43/$1': /\/\/.*?\/(.*)/
			}),
			pipe.debug(),
			pipe('tianma-mark@0.9.7'),
			pipe('tianma-hozdebug@0.9.1'),
			config.enableAjaxMock ? pipe('tianma-ajax-mock') : function(c,n){n();},
			function (context, next) {
				var response = context.response,
					mime = [
						'application/vnd.ms-fontobject',
						'application/x-font-ttf',
						'font/opentype',
						'application/x-font-woff',
						'application/font-woff'
					];

				if (mime.indexOf(response.head('content-type')) !== -1) {
					context.response.head('access-control-allow-origin', '*');
				}

				next();
			}
		])
		.start();
